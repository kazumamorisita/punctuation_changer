<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>å¥èª­ç‚¹ãƒã‚§ãƒƒã‚«ãƒ¼</title>

<style>
/* ===== å…¨ä½“ ===== */
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f7f7f7;
  margin: 0;
  padding: 0;
  color: #333;
  min-height: 100vh;
}

/* ===== ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */
.main-layout {
  display: flex;
  min-height: 100vh;
  flex-wrap: wrap;
}

.left-screen {
  flex: 1;
  min-width: 300px;
  padding: 40px;
}

.right-screen {
  flex: 0 0 400px;
  min-width: 320px;
  background: #e3f2fd;
  padding: 40px;
  border-left: 2px solid #1976d2;
  display: none;
}

.right-screen.show {
  display: block;
}

.container {
  max-width: 800px;
  margin: auto;
  background: #fff;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

h1 {
  margin-top: 0;
}

/* ===== å…¥åŠ› ===== */
textarea {
  width: 100%;
  height: 180px;
  font-size: 16px;
  padding: 12px;
  box-sizing: border-box;
  border-radius: 6px;
  border: 1px solid #ccc;
  resize: vertical;
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
button {
  margin-top: 16px;
  padding: 10px 18px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

button.primary {
  background: #007bff;
  color: #fff;
}

button.secondary {
  background: #ddd;
}

/* å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ä¸­å¤®æƒãˆ */
#executeBtn {
  display: block;
  margin: 16px auto;
}

/* ===== çµæœ ===== */
#resultArea {
  margin-top: 30px;
}

#resultTitle {
  text-align: center;
  margin-bottom: 20px;
}

#resultText {
  white-space: pre-wrap;
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;
  background: #f2f2f2;
  padding: 12px;
  border-radius: 6px;
  max-width: 100%;
  overflow-x: auto;
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: #fff;
  padding: 24px;
  border-radius: 8px;
  width: 90%;
  max-width: 420px;
}

.modal h2 {
  margin-top: 0;
}

.option-group {
  margin-bottom: 16px;
}

.option-group label {
  display: block;
  margin: 6px 0;
  cursor: pointer;
}

.modal-footer {
  text-align: right;
}

/* ===== ãƒã‚¤ãƒ©ã‚¤ãƒˆ ===== */
.highlight-jp-comma {
  background-color: #fff3cd;
  border-bottom: 2px solid #f0ad4e;
}

.highlight-jp-period {
  background-color: #d4edda;
  border-bottom: 2px solid #28a745;
}

.highlight-en-comma-full {
  background-color: #d1ecf1;
  border-bottom: 2px solid #17a2b8;
}

.highlight-en-comma-half {
  background-color: #f8d7da;
  border-bottom: 2px solid #dc3545;
}

.highlight-en-period-full {
  background-color: #e2e3ff;
  border-bottom: 2px solid #6f42c1;
}

.highlight-en-period-half {
  background-color: #fff2cc;
  border-bottom: 2px solid #fd7e14;
}

.issue-list {
  margin-top: 12px;
  font-size: 14px;
  color: #555;
}

.issue-detail {
  font-size: 13px;
  color: #666;
  line-height: 1.4;
}

.issue-item {
  padding: 12px 16px;
  margin: 8px 0;
  background: linear-gradient(145deg, #ffffff, #f0f0f0);
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.12);
  position: relative;
  user-select: none;
  font-weight: 500;
  font-size: 13px;
  color: #666;
  line-height: 1.4;
}

.issue-item::before {
  content: "ğŸ¯";
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0.6;
  font-size: 12px;
}

.issue-item:hover {
  background: linear-gradient(145deg, #fff3cd, #ffeaa7);
  border-color: #f39c12;
  box-shadow: 0 6px 12px rgba(243,156,18,0.3);
  transform: translateY(-2px);
  color: #333;
}

.issue-item:hover::before {
  opacity: 1;
}

.issue-item:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(243,156,18,0.2);
}

/* ã‚¸ãƒ£ãƒ³ãƒ—ãƒã‚¤ãƒ©ã‚¤ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
.highlight-target {
  background-color: #ff6b6b !important;
  animation: pulse-highlight 2s ease-in-out;
}

@keyframes pulse-highlight {
  0% { background-color: #ff6b6b; }
  50% { background-color: #ff8e8e; }
  100% { background-color: #ff6b6b; }
}

/* ===== çµ±è¨ˆ =====  */
#statisticsArea {
  margin-top: 20px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid #007bff;
}

#statisticsContent {
  font-size: 14px;
  color: #495057;
}

#statisticsContent div {
  margin: 4px 0;
}

/* ===== å·¦å³åˆ†å‰²ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */
.split-layout {
  display: flex;
  gap: 30px;
  margin-top: 30px;
}

.left-panel {
  flex: 1;
}

.right-panel {
  flex: 0 0 350px;
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  border-left: 4px solid #007bff;
}

.right-panel h4 {
  margin-top: 0;
  color: #495057;
}

.stats-section {
  margin-bottom: 20px;
}

.summary-section {
  font-size: 16px;
  font-weight: 500;
  color: #495057;
}

/* ===== çµ±è¨ˆé …ç›®ã®ãƒœã‚¿ãƒ³é¢¨ã‚¹ã‚¿ã‚¤ãƒ« ===== */
.stats-item {
  padding: 12px 16px;
  margin: 8px 0;
  background: linear-gradient(145deg, #ffffff, #f0f0f0);
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.12);
  position: relative;
  user-select: none;
  font-weight: 500;
}

.stats-item::before {
  content: "ğŸ‘†";
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0.6;
  font-size: 12px;
}

.stats-item:hover {
  background: linear-gradient(145deg, #e3f2fd, #bbdefb);
  border-color: #2196f3;
  box-shadow: 0 6px 12px rgba(33,150,243,0.3);
  transform: translateY(-2px);
}

.stats-item:hover::before {
  opacity: 1;
}

.stats-item:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(33,150,243,0.2);
}

.stats-item.filtered {
  background: linear-gradient(145deg, #1976d2, #1565c0);
  color: white;
  border-color: #0d47a1;
  box-shadow: 0 4px 8px rgba(25,118,210,0.4);
}

.stats-item.filtered::before {
  content: "âœ“";
  color: white;
  opacity: 1;
}

.stats-point {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 8px;
  vertical-align: middle;
}

.stats-point.jp-comma {
  background-color: #f0ad4e;
}

.stats-point.jp-period {
  background-color: #28a745;
}

.stats-point.en-comma-full {
  background-color: #17a2b8;
}

.stats-point.en-comma-half {
  background-color: #dc3545;
}

.stats-point.en-period-full {
  background-color: #6f42c1;
}

.stats-point.en-period-half {
  background-color: #fd7e14;
}

/* ===== å††ã‚°ãƒ©ãƒ• ===== */
.chart-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.chart-title {
  color: #1976d2;
  margin: 0;
  font-size: 24px;
  flex: 1;
}

.pie-chart {
  width: 80px;
  height: 80px;
  margin-left: 20px;
}

.chart-legend {
  margin-top: 10px;
  font-size: 11px;
  color: #666;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.legend-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

/* ===== å·®åˆ†è¡¨ç¤º ===== */
.diff-container {
  position: relative;
  line-height: 1.6;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #e9ecef;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  white-space: pre-wrap;
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;
  max-width: 100%;
  overflow-x: auto;
}

.diff-changed {
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  color: #1976d2;
  padding: 2px 4px;
  border-radius: 4px;
  font-weight: 500;
  border: 1px solid #90caf9;
  cursor: pointer;
  position: relative;
  display: inline;
  transition: all 0.2s ease;
}

.diff-changed:hover {
  background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
}

.diff-tooltip {
  position: absolute;
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s ease;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 5px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
}

.diff-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  border: 6px solid transparent;
  border-top-color: rgba(0, 0, 0, 0.9);
  transform: translateX(-50%);
}

.diff-changed:hover .diff-tooltip {
  opacity: 1;
  visibility: visible;
}

.diff-summary {
  margin-top: 15px;
  padding: 10px;
  background: #e8f5e8;
  border-left: 4px solid #4caf50;
  border-radius: 0 6px 6px 0;
  font-size: 14px;
  color: #2e7d32;
}

/* ===== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ ===== */

/* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã‚µã‚¤ã‚º */
@media (max-width: 1024px) {
  .main-layout {
    flex-direction: column;
  }
  
  .left-screen,
  .right-screen {
    padding: 30px 20px;
    flex: none;
  }
  
  .right-screen {
    border-left: none;
    border-top: 2px solid #1976d2;
  }
  
  .chart-container {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .pie-chart {
    margin-left: 0;
    margin-top: 10px;
  }
}

/* ãƒ¢ãƒã‚¤ãƒ«ã‚µã‚¤ã‚º */
@media (max-width: 768px) {
  .left-screen,
  .right-screen {
    padding: 20px 15px;
  }
  
  h1 {
    font-size: 24px;
    text-align: center;
  }
  
  .chart-title {
    font-size: 20px;
  }

  .chart-container {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  textarea {
    height: 150px;
    font-size: 14px;
  }
  
  .stats-item,
  .issue-item {
    padding: 10px 12px;
    font-size: 13px;
  }
  
  .copy-button {
    padding: 10px 14px;
    font-size: 14px;
  }
  
  #resultText,
  .diff-container {
    font-size: 14px;
    padding: 10px;
    word-break: break-all; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ã‚ˆã‚Šç©æ¥µçš„ã«æŠ˜ã‚Šè¿”ã— */
  }
  
  .modal-content {
    width: 95%;
    margin: 20px auto;
  }
  
  .pie-chart {
    width: 60px;
    height: 60px;
  }
  
  .chart-legend {
    font-size: 10px;
  }
}

/* å°å‹ãƒ¢ãƒã‚¤ãƒ« */
@media (max-width: 480px) {
  .left-screen,
  .right-screen {
    padding: 15px 10px;
  }
  
  h1 {
    font-size: 20px;
  }
  
  .chart-title {
    font-size: 18px;
  }

  .chart-container {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  textarea {
    height: 120px;
    font-size: 14px;
  }
  
  .stats-item,
  .issue-item {
    padding: 8px 10px;
    font-size: 12px;
    margin: 4px 0;
  }
  
  .copy-button {
    padding: 8px 12px;
    font-size: 13px;
  }
  
  #resultText,
  .diff-container {
    font-size: 13px;
    padding: 8px;
    line-height: 1.4;
    word-break: break-all; /* å°å‹ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ã‚ˆã‚Šç©æ¥µçš„ã«æŠ˜ã‚Šè¿”ã— */
  }
  
  .pie-chart {
    width: 50px;
    height: 50px;
  }
  
  .chart-legend {
    font-size: 9px;
    gap: 4px;
  }
  
  .stats-section,
  .summary-section {
    padding: 15px;
  }
  
  /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã®ã¿çµ±è¨ˆã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º */
  .stats-jump-button {
    display: inline-block !important;
  }
}

/* ===== ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ ===== */
.copy-container {
  position: relative;
  margin-top: 10px;
  text-align: center;
}

.copy-button {
  background: linear-gradient(145deg, #28a745, #20c997);
  color: white;
  border: 2px solid #1e7e34;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(40,167,69,0.3);
  position: relative;
  user-select: none;
  display: inline-block;
}

.copy-button::before {
  content: "ğŸ“‹";
  margin-right: 6px;
}

.copy-button:hover {
  background: linear-gradient(145deg, #218838, #1abc9c);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(40,167,69,0.4);
}

.copy-button:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(40,167,69,0.2);
}

.copy-button.success {
  background: linear-gradient(145deg, #17a2b8, #138496);
  border-color: #117a8b;
}

.copy-button.success::before {
  content: "âœ“";
}

/* ãƒ¢ãƒã‚¤ãƒ«ç”¨çµ±è¨ˆã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ */
.stats-jump-button {
  background: linear-gradient(145deg, #6f42c1, #5a32a3);
  color: white;
  border: 2px solid #4c2a85;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(111,66,193,0.3);
  position: relative;
  user-select: none;
  display: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤º */
  margin: 0 10px;
}

.stats-jump-button::before {
  content: "ğŸ“Š";
  margin-right: 6px;
}

.stats-jump-button:hover {
  background: linear-gradient(145deg, #5a32a3, #4c2a85);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(111,66,193,0.4);
}

.stats-jump-button:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(111,66,193,0.2);
}

#resultText {
  position: relative;
}

.centered {
  text-align: center;
  margin: 0 auto
}

</style>
</head>

<body>
<div class="main-layout">
  <!-- å·¦ç”»é¢ï¼šãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="left-screen">
    <div class="container">
      <h1 class="centered">å¥èª­ç‚¹ãƒã‚§ãƒƒã‚«ãƒ¼</h1>
      <h2 class="centered">ç¾åœ¨ã¯Î²ç‰ˆã§ã™ã€‚å°†æ¥çš„ã«åˆ©ç”¨å›æ•°åˆ¶é™ãƒ»æœ‰æ–™åŒ–ã‚’äºˆå®šã—ã¦ã„ã¾ã™ã€‚</h2>

      <textarea id="inputText" placeholder="ã“ã“ã«æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>

      <button class="primary" id="executeBtn">å®Ÿè¡Œã™ã‚‹</button>

      <div id="resultArea" style="display:none;">
        <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap;">
          <h3 id="resultTitle"></h3>
          <button class="stats-jump-button" id="statsJumpButton" onclick="jumpToStats()">çµ±è¨ˆæƒ…å ±ã‚’è¦‹ã‚‹</button>
        </div>
        <div class="copy-container">
          <button class="copy-button" id="copyButton" onclick="copyResultText()" style="display:none;">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
        <div id="resultText"></div>
        <div id="statisticsArea" style="display:none;">
          <h4>å¥èª­ç‚¹ã®çµ±è¨ˆ</h4>
          <div id="statisticsContent"></div>
        </div>
        <h4 id="resultSummary"></h4>
      </div>
    </div>
  </div>

  <!-- å³ç”»é¢ï¼šçµ±è¨ˆæƒ…å ± -->
  <div class="right-screen" id="rightScreen">
    <div class="chart-container">
      <h2 class="chart-title">å¥èª­ç‚¹åˆ†æçµæœ</h2>
      <div>
        <svg class="pie-chart" id="pieChart" viewBox="0 0 42 42"></svg>
        <div class="chart-legend" id="chartLegend"></div>
      </div>
    </div>
    
    <div class="stats-section">
      <h3>çµ±è¨ˆæƒ…å ±</h3>
      <div id="rightStatsContent"></div>
    </div>
    
    <div class="summary-section">
      <h3>è©³ç´°æƒ…å ±</h3>
      <div id="rightSummaryContent"></div>
    </div>
  </div>
</div>

<!-- ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>ã©ã†ã—ãŸã„ã§ã™ã‹ï¼Ÿ</h2>

    <div class="option-group">
      <strong>ãƒã‚§ãƒƒã‚¯</strong>
      <label><input type="radio" name="action" value="check-auto"> å¥èª­ç‚¹ã‚’ãƒã‚§ãƒƒã‚¯(æ–‡ç« ä¸­ã®,.ï¼Œï¼ã€ã€‚ã‚’æ•°ãˆã‚‹)</label>
    </div>

    <div class="option-group">
      <strong>å¤‰æ›</strong>
      <label><input type="radio" name="action" value="convert-jp"> æ—¥æœ¬èªã®å¥èª­ç‚¹ã«çµ±ä¸€</label>
      <label><input type="radio" name="action" value="convert-en"> è‹±èªã®å¥èª­ç‚¹ã«çµ±ä¸€</label>
    </div>

    <div class="option-group" id="widthGroup" style="display:none;">
        <strong>è¡¨è¨˜</strong>
        <label>
            <input type="radio" name="width" value="full" checked>
            å…¨è§’ï¼ˆï¼Œï¼ï¼‰
        </label>
        <label>
            <input type="radio" name="width" value="half">
            åŠè§’ï¼ˆ,.ï¼‰
        </label>
    </div>  

    <div class="modal-footer">
      <button class="secondary" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="primary" onclick="submitAction()">å®Ÿè¡Œ</button>
    </div>
  </div>
</div>



<script>
const modal = document.getElementById("modal");
const inputText = document.getElementById("inputText");
const resultArea = document.getElementById("resultArea");
const resultTitle = document.getElementById("resultTitle");
const resultText = document.getElementById("resultText");
const resultSummary = document.getElementById("resultSummary");
const statisticsArea = document.getElementById("statisticsArea");
const statisticsContent = document.getElementById("statisticsContent");
const rightScreen = document.getElementById("rightScreen");
const rightStatsContent = document.getElementById("rightStatsContent");
const rightSummaryContent = document.getElementById("rightSummaryContent");
const copyButton = document.getElementById("copyButton");
const statsJumpButton = document.getElementById("statsJumpButton");
const pieChart = document.getElementById("pieChart");
const chartLegend = document.getElementById("chartLegend");
const widthGroup = document.getElementById("widthGroup");

document.querySelectorAll('input[name="action"]').forEach(radio => {
  radio.addEventListener("change", () => {
    if (radio.value.startsWith("convert")) {
      widthGroup.style.display = "block";
    } else {
      widthGroup.style.display = "none";
    }
  });
});


function escapeHtml(str) {
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

function highlightTextByLine(text, issues) {
  const lines = text.split("\n");

  // è¡Œã”ã¨ã« issues ã‚’ã¾ã¨ã‚ã‚‹
  const issuesByLine = {};
  issues.forEach((issue, index) => {
    // å„issueã«ä¸€æ„ã®IDã‚’ä»˜ä¸
    issue.id = `issue-${index}`;
    if (!issuesByLine[issue.line]) {
      issuesByLine[issue.line] = [];
    }
    issuesByLine[issue.line].push(issue);
  });

  return lines.map((lineText, idx) => {
    const lineNo = idx + 1;
    const lineIssues = issuesByLine[lineNo];

    if (!lineIssues) {
      return escapeHtml(lineText);
    }

    // index é †ã«å‡¦ç†
    lineIssues.sort((a, b) => a.index - b.index);

    let result = "";
    let last = 0;

    lineIssues.forEach(issue => {
      result += escapeHtml(lineText.slice(last, issue.index));

      let cls = "";
      if (issue.type === "jp-comma") {
        cls = "highlight-jp-comma";
      } else if (issue.type === "jp-period") {
        cls = "highlight-jp-period";
      } else if (issue.type === "en-comma-full") {
        cls = "highlight-en-comma-full";
      } else if (issue.type === "en-comma-half") {
        cls = "highlight-en-comma-half";
      } else if (issue.type === "en-period-full") {
        cls = "highlight-en-period-full";
      } else if (issue.type === "en-period-half") {
        cls = "highlight-en-period-half";
      }

      result += `<span id="${issue.id}" class="${cls}" title="${issue.message}">${escapeHtml(lineText[issue.index])}</span>`;

      last = issue.index + 1;
    });

    result += escapeHtml(lineText.slice(last));
    return result;
  }).join("\n");
}

// å·®åˆ†è¨ˆç®—æ©Ÿèƒ½
function createDiffDisplay(originalText, convertedText, changes) {
  if (!changes || changes.length === 0) {
    return `<div class="diff-container">${escapeHtml(convertedText)}</div>`;
  }

  let result = '';
  let lastIndex = 0;
  let changeIndex = 0;
  
  // å¤‰æ›´æƒ…å ±ã‚’ä½ç½®é †ã§ã‚½ãƒ¼ãƒˆ
  const sortedChanges = [...changes].sort((a, b) => a.position - b.position);
  
  for (const change of sortedChanges) {
    // å¤‰æ›´å‰ã®éƒ¨åˆ†ã‚’è¿½åŠ 
    if (change.position > lastIndex) {
      result += escapeHtml(convertedText.slice(lastIndex, change.position));
    }
    
    // å¤‰æ›´ã•ã‚ŒãŸæ–‡å­—ã‚’è¿½åŠ ï¼ˆãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ä»˜ãï¼‰
    const changedChar = convertedText[change.position];
    const tooltip = `${change.original} â†’ ${change.converted}`;
    result += `<span class="diff-changed" data-tooltip="${escapeHtml(tooltip)}">${escapeHtml(changedChar)}<span class="diff-tooltip">${escapeHtml(tooltip)}</span></span>`;
    
    lastIndex = change.position + 1;
    changeIndex++;
  }
  
  // æ®‹ã‚Šã®éƒ¨åˆ†ã‚’è¿½åŠ 
  if (lastIndex < convertedText.length) {
    result += escapeHtml(convertedText.slice(lastIndex));
  }
  
  return `<div class="diff-container">${result}</div>`;
}

// æ–‡å­—ãƒ¬ãƒ™ãƒ«ã§ã®å·®åˆ†è¨ˆç®—
function calculateDiff(originalText, convertedText) {
  const changes = [];
  let originalIndex = 0;
  let convertedIndex = 0;
  
  while (originalIndex < originalText.length && convertedIndex < convertedText.length) {
    if (originalText[originalIndex] !== convertedText[convertedIndex]) {
      changes.push({
        position: convertedIndex,
        original: originalText[originalIndex],
        converted: convertedText[convertedIndex]
      });
    }
    originalIndex++;
    convertedIndex++;
  }
  
  return changes;
}

document.getElementById("executeBtn").onclick = () => {
  if (!inputText.value.trim()) {
    alert("æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }
  modal.style.display = "flex";
};

function closeModal() {
  modal.style.display = "none";
}

function submitAction() {
  const selected = document.querySelector('input[name="action"]:checked');
  if (!selected) {
    alert("æ“ä½œã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }

  const [mode, style] = selected.value.split("-");

    let width = "auto";
    if (mode === "convert") {
        const selectedWidth = document.querySelector('input[name="width"]:checked');
        if (selectedWidth) {
            width = selectedWidth.value;
        }
    }

  closeModal();

  fetch("/api/punctuation/check", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      text: inputText.value,
      mode: mode,
      style: style,
      width: width
    })
  })
  .then(res => {
    // 429ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼‰ã®ç‰¹åˆ¥å‡¦ç†
    if (res.status === 429) {
      resultArea.style.display = "block";
      resultTitle.textContent = "åˆ©ç”¨åˆ¶é™";
      rightScreen.classList.remove("show");
      resultText.textContent = "âš ï¸ æœ¬æ—¥ã®ç„¡æ–™åˆ©ç”¨å›æ•°ã‚’è¶…ãˆã¾ã—ãŸ";
      resultSummary.textContent = "";
      copyButton.style.display = "none";
      statisticsArea.style.display = "none";
      return Promise.reject("rate_limit"); // ç‰¹åˆ¥ãªãƒªã‚¸ã‚§ã‚¯ãƒˆã§chainã‚’åœæ­¢
    }
    
    // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‡¦ç†
    if (!res.ok) {
      return res.json().then(errorData => {
        throw new Error(errorData.detail || `ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ (${res.status})`);
      });
    }
    return res.json();
  })
  .then(data => {
    resultArea.style.display = "block";
    resultTitle.textContent = `å®Ÿè¡Œçµæœï¼ˆ${mode === "check" ? "ãƒã‚§ãƒƒã‚¯" : "å¤‰æ›"}ï¼‰`;

    // ===== ãƒã‚§ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ =====
    if (mode === "check") {
      if (!data.issues || data.issues.length === 0) {
        // å³ç”»é¢ã‚’éè¡¨ç¤º
        rightScreen.classList.remove("show");
        resultText.textContent = "âœ… å•é¡Œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ";
        resultSummary.textContent = "";
        statisticsArea.style.display = "none";
        copyButton.style.display = "none";
        // statsJumpButtonã¯CSSã§åˆ¶å¾¡ã•ã‚Œã‚‹ã®ã§JavaScriptã§ã¯è§¦ã‚‰ãªã„
        statsJumpButton.style.display = "none"; // ã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
        return;
      }

      // å·¦ç”»é¢ï¼šå®Ÿè¡Œçµæœ
      resultText.innerHTML = highlightTextByLine(inputText.value, data.issues);
      resultSummary.textContent = "";
      statisticsArea.style.display = "none";
      copyButton.style.display = "inline-block"; // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
      // statsJumpButtonã¯CSSãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã§åˆ¶å¾¡

      // å³ç”»é¢ã‚’è¡¨ç¤º
      rightScreen.classList.add("show");
      
      // å††ã‚°ãƒ©ãƒ•ã‚’ä½œæˆ
      createPieChart(data.issues);
      
      // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      originalIssues = data.issues;
      currentFilter = null;

      // å³ç”»é¢ï¼šçµ±è¨ˆæƒ…å ±
      if (data.statistics && data.statistics.length > 0) {
        const statsHtml = data.statistics.map((stat, index) => {
          const issueInfo = getIssueTypeFromStat(stat, data.issues);
          const colorPoint = issueInfo.colorClass ? `<span class="stats-point ${issueInfo.colorClass}"></span>` : '';
          return `<div class="stats-item" onclick="filterByType('${issueInfo.type}')">${colorPoint}â€¢ ${stat}</div>`;
        }).join("");
        rightStatsContent.innerHTML = statsHtml + '<button class="filter-reset" onclick="resetFilter()" style="display:none;">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ</button>';
      } else {
        rightStatsContent.innerHTML = '<div class="stats-item">çµ±è¨ˆæƒ…å ±ãªã—</div>';
      }

      // å³ç”»é¢ï¼šè©³ç´°æƒ…å ±ï¼ˆåˆæœŸè¡¨ç¤ºï¼‰
      updateDetailInfo(data.issues);

    }

    // ===== å¤‰æ›ãƒ¢ãƒ¼ãƒ‰ =====
    else {
      // å³ç”»é¢ã‚’éè¡¨ç¤º
      rightScreen.classList.remove("show");
      
      // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰å¤‰æ›´æƒ…å ±ã‚’å—ã‘å–ã£ãŸå ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãã†ã§ãªã‘ã‚Œã°ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§è¨ˆç®—
      let changes = data.changes || calculateDiff(inputText.value, data.result_text);
      
      if (changes.length > 0) {
        resultText.innerHTML = createDiffDisplay(inputText.value, data.result_text, changes);
      } else {
        resultText.innerHTML = `<div class="diff-container">${escapeHtml(data.result_text)}</div>`;
      }
      
      statisticsArea.style.display = "none";
      copyButton.style.display = "inline-block"; // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
      // statsJumpButtonã¯CSSã§éè¡¨ç¤ºã«å›ºå®šã•ã‚Œã¦ã„ã‚‹
      statsJumpButton.style.display = "none"; // çµ±è¨ˆã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º

      if (data.summary.total_changes > 0) {
        resultSummary.innerHTML = `<div class="diff-summary">âœ… ${data.summary.total_changes} ç®‡æ‰€ã‚’å¤‰æ›ã—ã¾ã—ãŸï¼ˆå¤‰æ›´ç®‡æ‰€ã¯é’è‰²ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã§è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ï¼‰</div>`;
      } else {
        resultSummary.innerHTML = `<div class="diff-summary">â„¹ï¸ å¤‰æ›ã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>`;
      }
    }
  })
  .catch((error) => {
    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ä½•ã‚‚å‡¦ç†ã—ãªã„ï¼ˆæ—¢ã«å‡¦ç†æ¸ˆã¿ï¼‰
    if (error === "rate_limit") {
      return;
    }
    
    resultArea.style.display = "block";
    resultTitle.textContent = "ã‚¨ãƒ©ãƒ¼";
    
    // å³ç”»é¢ã‚’éè¡¨ç¤º
    rightScreen.classList.remove("show");
    
    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    if (error.message) {
      resultText.textContent = `âš ï¸ ${error.message}`;
    } else {
      resultText.textContent = "ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
    }
    
    resultSummary.textContent = "";
    copyButton.style.display = "none"; // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
    // statsJumpButtonã¯CSSã§éè¡¨ç¤ºã«å›ºå®šã•ã‚Œã¦ã„ã‚‹
    statisticsArea.style.display = "none";
  });
}

// è©³ç´°æƒ…å ±ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¸ãƒ£ãƒ³ãƒ—æ©Ÿèƒ½
function jumpToIssue(issueId) {
  const targetElement = document.getElementById(issueId);
  if (!targetElement) return;
  
  // æ—¢å­˜ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
  document.querySelectorAll('.highlight-target').forEach(el => {
    el.classList.remove('highlight-target');
  });
  
  // æ–°ã—ã„ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¿½åŠ 
  targetElement.classList.add('highlight-target');
  
  // è¦ç´ ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  targetElement.scrollIntoView({
    behavior: 'smooth',
    block: 'center'
  });
  
  // 2ç§’å¾Œã«ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
  setTimeout(() => {
    targetElement.classList.remove('highlight-target');
  }, 2000);
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
let originalIssues = [];
let currentFilter = null;

// çµ±è¨ˆæƒ…å ±ã‹ã‚‰issueã‚¿ã‚¤ãƒ—ã¨ã‚«ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°
function getIssueTypeFromStat(stat, issues) {
  if (stat.includes('æ—¥æœ¬èªã®èª­ç‚¹')) return { type: 'jp-comma', colorClass: 'jp-comma' };
  if (stat.includes('æ—¥æœ¬èªã®å¥ç‚¹')) return { type: 'jp-period', colorClass: 'jp-period' };
  if (stat.includes('è‹±èªã®ã‚³ãƒ³ãƒï¼ˆå…¨è§’')) return { type: 'en-comma-full', colorClass: 'en-comma-full' };
  if (stat.includes('è‹±èªã®ã‚³ãƒ³ãƒï¼ˆåŠè§’')) return { type: 'en-comma-half', colorClass: 'en-comma-half' };
  if (stat.includes('è‹±èªã®ãƒ”ãƒªã‚ªãƒ‰ï¼ˆå…¨è§’')) return { type: 'en-period-full', colorClass: 'en-period-full' };
  if (stat.includes('è‹±èªã®ãƒ”ãƒªã‚ªãƒ‰ï¼ˆåŠè§’')) return { type: 'en-period-half', colorClass: 'en-period-half' };
  return { type: null, colorClass: null };
}

// å††ã‚°ãƒ©ãƒ•ã‚’æç”»ã™ã‚‹é–¢æ•°
function createPieChart(issues) {
  // å„å¥èª­ç‚¹ã®ã‚«ã‚¦ãƒ³ãƒˆ
  const counts = {
    'jp-comma': 0,
    'jp-period': 0,
    'en-comma-full': 0,
    'en-comma-half': 0,
    'en-period-full': 0,
    'en-period-half': 0
  };
  
  issues.forEach(issue => {
    if (counts.hasOwnProperty(issue.type)) {
      counts[issue.type]++;
    }
  });
  
  const total = Object.values(counts).reduce((sum, count) => sum + count, 0);
  
  if (total === 0) {
    pieChart.innerHTML = '<circle cx="21" cy="21" r="15" fill="#e0e0e0"/>';
    chartLegend.innerHTML = 'ãƒ‡ãƒ¼ã‚¿ãªã—';
    return;
  }
  
  // è‰²ã®å®šç¾©
  const colors = {
    'jp-comma': '#f0ad4e',
    'jp-period': '#28a745',
    'en-comma-full': '#17a2b8',
    'en-comma-half': '#dc3545',
    'en-period-full': '#6f42c1',
    'en-period-half': '#fd7e14'
  };
  
  const labels = {
    'jp-comma': 'ã€',
    'jp-period': 'ã€‚',
    'en-comma-full': 'ï¼Œ',
    'en-comma-half': ',',
    'en-period-full': 'ï¼',
    'en-period-half': '.'
  };
  
  let cumulativePercentage = 0;
  let svgContent = '';
  let legendContent = '';
  
  Object.entries(counts).forEach(([type, count]) => {
    if (count > 0) {
      const percentage = count / total;
      const startAngle = cumulativePercentage * 360;
      const endAngle = (cumulativePercentage + percentage) * 360;
      
      // SVGã®ãƒ‘ã‚¹ã‚’ä½œæˆ
      const x1 = 21 + 15.915 * Math.cos((startAngle - 90) * Math.PI / 180);
      const y1 = 21 + 15.915 * Math.sin((startAngle - 90) * Math.PI / 180);
      const x2 = 21 + 15.915 * Math.cos((endAngle - 90) * Math.PI / 180);
      const y2 = 21 + 15.915 * Math.sin((endAngle - 90) * Math.PI / 180);
      
      const largeArcFlag = percentage > 0.5 ? 1 : 0;
      
      if (percentage === 1) {
        // å…¨å††ã®å ´åˆ
        svgContent += `<circle cx="21" cy="21" r="15.915" fill="${colors[type]}"/>`;
      } else {
        // å††å¼§ã®å ´åˆ
        svgContent += `<path d="M 21 21 L ${x1} ${y1} A 15.915 15.915 0 ${largeArcFlag} 1 ${x2} ${y2} Z" fill="${colors[type]}"/>`;
      }
      
      // å‡¡ä¾‹ã‚’ä½œæˆ
      legendContent += `<div class="legend-item"><div class="legend-dot" style="background-color: ${colors[type]}"></div><span>${labels[type]}(${count})</span></div>`;
      
      cumulativePercentage += percentage;
    }
  });
  
  pieChart.innerHTML = svgContent;
  chartLegend.innerHTML = legendContent;
}

// ã‚¿ã‚¤ãƒ—åˆ¥ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
function filterByType(issueType) {
  if (!originalIssues.length) return;
  
  currentFilter = issueType;
  const filteredIssues = originalIssues.filter(issue => issue.type === issueType);
  
  // çµ±è¨ˆæƒ…å ±ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  document.querySelectorAll('.stats-item').forEach(item => {
    item.classList.remove('filtered');
    if (item.onclick && item.onclick.toString().includes(issueType)) {
      item.classList.add('filtered');
    }
  });
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
  const resetBtn = document.querySelector('.filter-reset');
  if (resetBtn) resetBtn.style.display = 'inline-block';
  
  // è©³ç´°æƒ…å ±ã‚’æ›´æ–°
  updateDetailInfo(filteredIssues, issueType);
}

// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
function resetFilter() {
  currentFilter = null;
  
  // çµ±è¨ˆæƒ…å ±ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
  document.querySelectorAll('.stats-item').forEach(item => {
    item.classList.remove('filtered');
  });
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
  const resetBtn = document.querySelector('.filter-reset');
  if (resetBtn) resetBtn.style.display = 'none';
  
  // å…ƒã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
  updateDetailInfo(originalIssues);
}

// è©³ç´°æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
function updateDetailInfo(issues, filterType = null) {
  const rightSummaryContent = document.getElementById('rightSummaryContent');
  
  if (filterType) {
    const typeNames = {
      'jp-comma': 'æ—¥æœ¬èªã®èª­ç‚¹ï¼ˆã€ï¼‰',
      'jp-period': 'æ—¥æœ¬èªã®å¥ç‚¹ï¼ˆã€‚ï¼‰',
      'en-comma-full': 'è‹±èªã®ã‚³ãƒ³ãƒï¼ˆå…¨è§’ï¼šï¼Œï¼‰',
      'en-comma-half': 'è‹±èªã®ã‚³ãƒ³ãƒï¼ˆåŠè§’ï¼š,ï¼‰',
      'en-period-full': 'è‹±èªã®ãƒ”ãƒªã‚ªãƒ‰ï¼ˆå…¨è§’ï¼šï¼ï¼‰',
      'en-period-half': 'è‹±èªã®ãƒ”ãƒªã‚ªãƒ‰ï¼ˆåŠè§’ï¼š.ï¼‰'
    };
    
    rightSummaryContent.innerHTML = `
      <div style="margin-bottom: 15px; font-weight: 500;">
        âš  ${issues.length} ç®‡æ‰€ã®${typeNames[filterType]}ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ
      </div>
      <div class="issue-detail">
          ${issues.map((i, index) =>
          `<div class="issue-item" onclick="jumpToIssue('${i.id}')">
            â€¢ ${i.message}ï¼ˆ${i.line}è¡Œç›®ï¼‰
          </div>`
          ).join("")}
      </div>
    `;
  } else {
    rightSummaryContent.innerHTML = `
      <div style="margin-bottom: 15px; font-weight: 500;">
        âš  ${issues.length} ç®‡æ‰€ã®å¥èª­ç‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ
      </div>
      <div class="issue-detail">
          ${issues.map((i, index) =>
          `<div class="issue-item" onclick="jumpToIssue('${i.id}')">
            â€¢ ${i.message}ï¼ˆ${i.line}è¡Œç›®ï¼‰
          </div>`
          ).join("")}
      </div>
    `;
  }
}

// çµ±è¨ˆæƒ…å ±ã¸ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹æ©Ÿèƒ½ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
function jumpToStats() {
  const rightScreen = document.getElementById('rightScreen');
  if (rightScreen && rightScreen.classList.contains('show')) {
    rightScreen.scrollIntoView({
      behavior: 'smooth',
      block: 'start'
    });
  }
}

// çµ±è¨ˆæƒ…å ±ã¸ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹æ©Ÿèƒ½ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
function jumpToStats() {
  const rightScreen = document.getElementById('rightScreen');
  if (rightScreen && rightScreen.classList.contains('show')) {
    rightScreen.scrollIntoView({
      behavior: 'smooth',
      block: 'start'
    });
  }
}

// å®Ÿè¡Œçµæœã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹æ©Ÿèƒ½
async function copyResultText() {
  const resultTextElement = document.getElementById('resultText');
  const copyButtonElement = document.getElementById('copyButton');
  
  try {
    // HTMLã‚¿ã‚°ã‚’é™¤å»ã—ã¦ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
    const textToCopy = resultTextElement.innerText || resultTextElement.textContent;
    
    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
    await navigator.clipboard.writeText(textToCopy);
    
    // æˆåŠŸæ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    const originalText = copyButtonElement.textContent;
    copyButtonElement.textContent = 'ã‚³ãƒ”ãƒ¼å®Œäº†!';
    copyButtonElement.classList.add('success');
    
    // 2ç§’å¾Œã«å…ƒã«æˆ»ã™
    setTimeout(() => {
      copyButtonElement.textContent = originalText;
      copyButtonElement.classList.remove('success');
    }, 2000);
    
  } catch (err) {
    // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
    const originalText = copyButtonElement.textContent;
    copyButtonElement.textContent = 'ã‚³ãƒ”ãƒ¼å¤±æ•—';
    
    setTimeout(() => {
      copyButtonElement.textContent = originalText;
    }, 2000);
  }
}
</script>

</body>
</html>
